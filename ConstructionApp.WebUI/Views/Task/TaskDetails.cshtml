@model Construction.Infrastructure.Models.ProjectTasksDTO
@inject IHttpContextAccessor Accessor
@{
    ViewData["Title"] = "Add Task";
    // Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/assets/summernote-editor/css/summernote-lite.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.2.0/sweetalert2.min.css">

<style>
    button {
        background-color: whitesmoke;
        border: 0;
        -webkit-box-shadow: none;
        box-shadow: none;
        font-size: 14px;
        font-weight: 500;
        border-radius: 7px;
        cursor: pointer;
        white-space: nowrap;
    }

    img {
        width: 200px;
    }

    input[type="text"] {
        padding: 12px 20px;
        display: inline-block;
        border: 1px solid #ccc;
        border-radius: 10px;
        box-sizing: border-box;
    }

    h1 {
        border-bottom: solid 2px grey;
    }

    #success {
        background: green;
    }

    #error {
        background: red;
    }

    #warning {
        background: coral;
    }

    #info {
        background: cornflowerblue;
    }

    #question {
        background: grey;
    }

    .bg-label-green {
        background-color: #ddf6e8 !important;
        color: #28c76f !important;
    }

    .bg-label-blue {
        background-color: #d9f2ff !important;
        color: #00cfe8 !important;
    }

    .bg-label-orange {
        background-color: #ffeeda !important;
        color: #ff9f43 !important;
    }

    .bg-label-red {
        background-color: #fce5e6 !important;
        color: #ea5455 !important;
    }
</style>
<style>
    .loader {
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        right: 0;
        background: rgba(0,0,0,0.5);
        z-index: 9999;
        text-align: center;
        width: 100%;
    }

    .loader_inner {
        position: absolute;
        top: 50%;
        left: 50%;
        margin-left: -50px;
        margin-top: -50px;
    }
</style>
<div class="page-content-section">



    <div class="container-fluid over-flow-auto px-md-4 px-0 tab-new mb-6 nav-tabs-shadow pt-2">

        <div class="row">
            <div class="col-12">
                <div class="nav-align-top ">
                    <ul class="nav nav-tabs" role="tablist">
                        @if ((Model.AccessList.Where(x => x.ModuleCode.Trim() == "P" && x.IsView == true).Count() > 0) || Model.UserType == 0)
                        {

                            <li class="nav-item">
                                <a href="~/Project/ProjectOverview/@Model.ProjectId"
                                   type="button"
                                   class="nav-link">
                                    Overview
                                </a>
                            </li>
                        }
                        @if ((Model.AccessList.Where(x => x.ModuleCode.Trim() == "T" && x.IsView == true).Count() > 0) || Model.UserType == 0)
                        {
                            <li class="nav-item">
                                <a href="~/Task/TaskDetails/@Model.ProjectId"
                                   type="button"
                                   class="nav-link active">
                                    Tasks
                                </a>
                            </li>
                        }
                        @if ((Model.AccessList.Where(x => x.ModuleCode.Trim() == "DC" && x.IsView == true).Count() > 0) || Model.UserType == 0)
                        {
                            <li class="nav-item">
                                <a href="~/Document/ProjectCategoryDirectory/@Model.EncProjectId"
                                   type="button"
                                   class="nav-link">
                                    Documents
                                </a>
                            </li>
                        }
                        @if ((Model.AccessList.Where(x => x.ModuleCode.Trim() == "D" && x.IsView == true).Count() > 0) || Model.UserType == 0)
                        {
                            <li class="nav-item">
                                <a href="~/Drawing/ProjectCategoryDirectory/@Model.EncProjectId"
                                   type="button"
                                   class="nav-link">
                                    Drawing
                                </a>
                            </li>
                        }
                        @if ((Model.AccessList.Where(x => x.ModuleCode.Trim() == "PH" && x.IsView == true).Count() > 0) || Model.UserType == 0)
                        {
                            <li class="nav-item">
                                <a href="~/Photo/ProjectCategoryDirectory/@Model.EncProjectId"
                                   type="button"
                                   class="nav-link">
                                    Photos
                                </a>
                            </li>
                        }
                        @if ((Model.AccessList.Where(x => x.ModuleCode.Trim() == "CM" && x.IsView == true).Count() > 0) || Model.UserType == 0)
                        {
                            if (Model.EncProjectId != null && Model.EncProjectId != "" && Model.EncProjectId != "0" && Model.EncProjectId != "undefined" && Model.EncProjectId != "null")
                            {
                                <li class="nav-item">
                                    <a href="~/Organization/ViewComments/@Model.EncProjectId"
                                       type="button"
                                       class="nav-link">
                                        Activities
                                    </a>
                                </li>
                            }
                            else
                            {
                                <li class="nav-item">
                                    <a href="~/Organization/Comments"
                                       type="button"
                                       class="nav-link">
                                        Activities
                                    </a>
                                </li>
                            }
                        }
                    </ul>
                </div>
            </div>
        </div>
    </div>


    <!-- rough -->
    @*   class="form-select select2 btn btn-secondary buttons-collection dropdown-toggle btn-label-primary me-4 waves-effect waves-light border-none" *@
    @*     <div class="container-fluid navbar-nav-right select-filter gap-2 flex-wrap pb-4 d-flex align-items-center" id="navbar-collapse"> *@
   


    <!--rough -->
    <!-- / Navbar -->
    <!-- Content wrapper -->
    <div class="container-fluid">
        <!-- Content -->



        <div class=" flex-grow-1">
            <div class="card">
                <div class="card-datatable table-responsive pt-0">

                    <div class="d-flex justify-content-between gap-3 flex-wrap flex-sm-nowrap align-items-center mt-3 mb-2">
                        <div>
                            <h5 class="card-title mb-0">Tasks</h5>
                        </div>
                        <div class="d-flex align-items-center flex-wrap flex-sm-nowrap gap-2">
                            @if (Accessor.HttpContext.Session.GetInt32("UserType") != 3)
                            {
                                <select name="selProject" id="selProject" onchange="javascript:ProjectDDL(this.value)" class="form-select min-width-select">
                                    @if (Model.ProjectList != null)
                                    {
                                        <option value="0"> Project</option>
                                        @foreach (var item in Model.ProjectList)
                                        {
                                            if (item.ProjectId == Model.ProjectId)
                                            {
                                                <option value="@item.ProjectId" selected>@item.ProjectName </option>


                                            }
                                            else
                                            {
                                                <option value="@item.ProjectId">@item.ProjectName </option>
                                            }
                                        }
                                    }
                                </select>
                            }
                            <select name="selPhase" id="selPhase" onchange="javascript:PhaseDDL(this.value)" class="form-select min-width-select">
                                @if (Model.PhaseList != null)
                                {
                                    <option value="0"> Phase</option>
                                    @foreach (var item in Model.PhaseList)
                                    {
                                        if (item.ID == Model.FPhaseId)
                                        {
                                            <option value="@item.ID" selected>@item.Phase </option>


                                        }
                                        else
                                        {
                                            <option value="@item.ID">@item.Phase </option>
                                        }
                                    }
                                }
                            </select>


                            <select name="SelPriorityId" id="SelPriorityId" onchange="javascript:PriorityDDL(this.value)" class="form-select min-width-select">
                                @if (Model.PriorityList != null)
                                {
                                    <option value="0">Priority</option>
                                    @foreach (var item in Model.PriorityList)
                                    {
                                        if (item.CompanyPriorityId == Model.FPriorityId)
                                        {
                                            <option value="@item.CompanyPriorityId" selected>@item.CompanyPriority </option>


                                        }
                                        else
                                        {
                                            <option value="@item.CompanyPriorityId">@item.CompanyPriority </option>
                                        }
                                    }
                                }
                            </select>

                            <select name="selStatus" id="selStatus" onchange="javascript:StatusDDL(this.value)" class="form-select min-width-select">
                                @if (Model.StatusList != null)
                                {
                                    <option value="0"> Status</option>
                                    @foreach (var item in Model.StatusList)
                                    {
                                        if (item.ID == Model.FStatusId)
                                        {
                                            <option value="@item.ID" selected>@item.Status </option>
                                        }
                                        else
                                        {
                                            <option value="@item.ID">@item.Status </option>
                                        }
                                    }
                                }
                            </select>
                            @if (Model.AccessList.Where(x => x.IsView == true).Count() > 0)
                            {

                                <button class="btn btn-primary" data-bs-toggle="offcanvas" data-bs-target="#add-new-task">
                                    <i class="fa fa-plus me-1"></i> Add New Task
                                </button>
                            }
                        </div>
                    </div>

                    <div id="accordionCustomIcon" class="accordion task-phases mt-4 accordion-custom-button">

                        <!-- Phase One (Original) -->
                        <div class="accordion-item">
                           @*  <h2 class="accordion-header text-body d-flex justify-content-between" id="accordionCustomIconOne">
                                <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse"
                                        data-bs-target="#phase-one" aria-controls="phase-one">
                                    Initiation
                                </button>
                            </h2> *@
                            <div id="phase-one" class="accordion-collapse collapse show" data-bs-parent="#accordionCustomIcon">
                                <div class="accordion-body">
                                    <!-- Table content remains the same -->
                                    <table class="project-datatable table">
                                        <thead>
                                            <tr>
                                                <th>Sr.No</th>
                                                <th>Task Name</th>
                                                <th>Owner</th>
                                                <th>Vendor</th>
                                                <th>Phase</th>
                                                <th>Priority</th>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Duration</th>
                                                <th>Status</th>
                                                <th>Created By</th>
                                                <th>Created On</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (Model.ProjectTaskList != null)
                                            {
                                                int iCtr = 1;
                                                @foreach (var item in Model.ProjectTaskList)
                                                {
                                                    <tr>
                                                        <td>@iCtr</td>
                                                        <td>
                                                            <div class="d-flex flex-wrap flex-md-nowrap gap-2 ">
                                                                <span>@item.TaskName</span>
                                                                <div class="action-button hover-action-button ms-auto">
                                                                    <a href="/Task/GetTaskView/@item.eTaskId" class="btn btn-outline-primary waves-effect">

                                                                        <i class="fa fa-eye me-1"></i> View
                                                                    </a>
                                                                </div>

                                                            </div>

                                                        </td>
                                                        <td>
                                                            @(item.TaskOwner == null ? "NA" : item.TaskOwner)
                                                        </td>
                                                        <td>
                                                            @(item.Vendor == null ? "NA" : item.Vendor)
                                                        </td>
                                                        <td>@item.Phase</td>
                                                        <td>
                                                            @if (item.Priority.Trim().ToUpper() == "LOW")
                                                            {
                                                                <span class="badge bg-label-green">@item.Priority</span>
                                                            }
                                                            else if (item.Priority.Trim().ToUpper() == "NORMAL")
                                                            {
                                                                <span class="badge bg-label-blue">@item.Priority</span>
                                                            }
                                                            else if (item.Priority.Trim().ToUpper() == "HIGH")
                                                            {
                                                                <span class="badge bg-label-orange">@item.Priority</span>
                                                            }
                                                            else
                                                            {
                                                                <span class="badge bg-label-red">@item.Priority</span>
                                                            }


                                                        </td>
                                                        <td>@item.StartDate</td>
                                                        <td>@item.EndDate</td>
                                                        <td>@item.Duration Days</td>
                                                        <td>
                                                            @if (item.Status.Trim().ToUpper() == "OPEN TASKS")
                                                            {
                                                                <span class="badge bg-label-danger">@item.Status</span>
                                                            }
                                                            else if (item.Status.Trim().ToUpper() == "OVERDUE")
                                                            {
                                                                <span class="badge bg-label-danger">@item.Status</span>
                                                            }
                                                            else if (item.Status.Trim().ToUpper() == "IN PROGRESS")
                                                            {
                                                                <span class="badge bg-label-warning">@item.Status</span>
                                                            }
                                                            else
                                                            {
                                                                <span class="badge  bg-label-success">@item.Status</span>
                                                            }
                                                        </td>
                                                        @*  <td>@item.Status</td>   *@
                                                        <td>@item.CreatedBy</td>
                                                        <td>@item.CreatedOn</td>

                                                        <td>
                                                            <a href="/Task/TaskView/@item.eTaskId"><i class="fa fa-eye text-success me-1"></i></a>


                                                            @if ((Model.AccessList.Where(x => x.IsView == true && x.ModuleCode.Trim() == "T").Count() > 0) || Model.UserType == 0)
                                                            {
                                                                <a href="/Task/GetTaskId/@item.eTaskId"><i class="fa fa-edit text-primary me-1"></i></a>
                                                            }
                                                            @if ((Model.AccessList.Where(x => x.IsView == true && x.ModuleCode.Trim() == "T").Count() > 0) || Model.UserType == 0)
                                                            {
                                                                <a href="#" onclick="DeleteTaskConfirmation('@item.eTaskId')"><i class="fa fa-trash text-danger me-1"></i></a>
                                                            }

                                                        </td>
                                                    </tr>
                                                    iCtr++;
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                      @*   <!-- Phase Two -->
                        <div class="accordion-item">
                            <h2 class="accordion-header text-body d-flex justify-content-between" id="accordionCustomIconTwo">
                                <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse"
                                        data-bs-target="#phase-two" aria-controls="phase-two">
                                    Planning and Design
                                </button>
                            </h2>
                            <div id="phase-two" class="accordion-collapse collapse show" data-bs-parent="#accordionCustomIcon">
                                <div class="accordion-body">
                                    <!-- Table content duplicated from Phase One -->
                                    <table class="project-datatable table">
                                        <thead>
                                            <tr>
                                                <th>Sr.No</th>
                                                <th>Task Name</th>
                                                <th>Owner</th>
                                                <th>Vendor</th>
                                                <th>Phase</th>
                                                <th>Priority</th>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Duration</th>
                                                <th>Status</th>
                                                <th>Created By</th>
                                                <th>Created On</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (Model.ProjectTaskList != null)
                                            {
                                                int iCtr = 1;
                                                @foreach (var item in Model.ProjectTaskList.Where(x => x.PhaseId == 2))
                                                {
                                                    <tr>
                                                        <td>@iCtr</td>
                                                        <td>
                                                            <div class="d-flex gap-2 ">
                                                                <span>@item.TaskName</span>
                                                                <div class="action-button hover-action-button ms-auto">
                                                                    <a href="/Task/GetTaskView/@item.eTaskId" class="btn btn-outline-primary waves-effect">

                                                                        <i class="fa fa-eye me-1"></i> View
                                                                    </a>
                                                                </div>

                                                            </div>

                                                        </td>
                                                        <td>
                                                            @(item.TaskOwner == null ? "NA" : item.TaskOwner)
                                                        </td>
                                                        <td>
                                                            @(item.Vendor == null ? "NA" : item.Vendor)
                                                        </td>
                                                        <td>@item.Phase</td>
                                                        <td>
                                                            @if (item.Priority.Trim().ToUpper() == "LOW")
                                                            {
                                                                <span class="bg-label-green">@item.Priority</span>
                                                            }
                                                            else if (item.Priority.Trim().ToUpper() == "NORMAL")
                                                            {
                                                                <span class="bg-label-blue">@item.Priority</span>
                                                            }
                                                            else if (item.Priority.Trim().ToUpper() == "HIGH")
                                                            {
                                                                <span class="bg-label-orange">@item.Priority</span>
                                                            }
                                                            else
                                                            {
                                                                <span class="bg-label-red">@item.Priority</span>
                                                            }


                                                        </td>
                                                        <td>@item.StartDate</td>
                                                        <td>@item.EndDate</td>
                                                        <td>@item.Duration</td>
                                                        <td>
                                                            @if (item.Status.Trim().ToUpper() == "OPEN TASKS")
                                                            {
                                                                <span class="badge bg-label-danger">@item.Status</span>
                                                            }
                                                            else if (item.Status.Trim().ToUpper() == "OVERDUE")
                                                            {
                                                                <span class="badge bg-label-danger">@item.Status</span>
                                                            }
                                                            else if (item.Status.Trim().ToUpper() == "IN PROGRESS")
                                                            {
                                                                <span class="badge bg-label-warning">@item.Status</span>
                                                            }
                                                            else
                                                            {
                                                                <span class="badge  bg-label-success">@item.Status</span>
                                                            }
                                                        </td>
                                                   
                                                        <td>@item.CreatedBy</td>
                                                        <td>@item.CreatedOn</td>

                                                        <td>
                                                            <a href="/Task/TaskView/@item.eTaskId"><i class="fa fa-eye text-success me-1"></i></a>


                                                            @if ((Model.AccessList.Where(x => x.IsView == true && x.ModuleCode.Trim() == "T").Count() > 0) || Model.UserType == 0)
                                                            {
                                                                <a href="/Task/GetTaskId/@item.eTaskId"><i class="fa fa-edit text-primary me-1"></i></a>
                                                            }
                                                            @if ((Model.AccessList.Where(x => x.IsView == true && x.ModuleCode.Trim() == "T").Count() > 0) || Model.UserType == 0)
                                                            {
                                                                <a href="#" onclick="DeleteTaskConfirmation('@item.eTaskId')"><i class="fa fa-trash text-danger me-1"></i></a>
                                                            }



                                                        </td>
                                                    </tr>
                                                    iCtr++;
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Phase Three -->
                        <div class="accordion-item">
                            <h2 class="accordion-header text-body d-flex justify-content-between" id="accordionCustomIconThree">
                                <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse"
                                        data-bs-target="#phase-three" aria-controls="phase-three">
                                    Execution (Construction Phase)
                                </button>
                            </h2>
                            <div id="phase-three" class="accordion-collapse collapse show" data-bs-parent="#accordionCustomIcon">
                                <div class="accordion-body">
                                    <!-- Table content duplicated from Phase One -->
                                    <table class="project-datatable table">
                                        <thead>
                                            <tr>
                                                <th>Sr.No</th>
                                                <th>Task Name</th>
                                                <th>Owner</th>
                                                <th>Vendor</th>
                                                <th>Phase</th>
                                                <th>Priority</th>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Duration</th>
                                                <th>Status</th>
                                                <th>Created By</th>
                                                <th>Created On</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (Model.ProjectTaskList != null)
                                            {
                                                int iCtr = 1;
                                                @foreach (var item in Model.ProjectTaskList.Where(x => x.PhaseId == 3))
                                                {
                                                    <tr>
                                                        <td>@iCtr</td>
                                                        <td>
                                                            <div class="d-flex gap-2 ">
                                                                <span>@item.TaskName</span>
                                                                <div class="action-button hover-action-button ms-auto">
                                                                    <a href="/Task/GetTaskView/@item.eTaskId" class="btn btn-outline-primary waves-effect">

                                                                        <i class="fa fa-eye me-1"></i> View
                                                                    </a>
                                                                </div>

                                                            </div>

                                                        </td>
                                                        <td>
                                                            @(item.TaskOwner == null ? "NA" : item.TaskOwner)
                                                        </td>
                                                        <td>
                                                            @(item.Vendor == null ? "NA" : item.Vendor)
                                                        </td>
                                                        <td>@item.Phase</td>
                                                        <td>
                                                            @if (item.Priority.Trim().ToUpper() == "LOW")
                                                            {
                                                                <span class="bg-label-green">@item.Priority</span>
                                                            }
                                                            else if (item.Priority.Trim().ToUpper() == "NORMAL")
                                                            {
                                                                <span class="bg-label-blue">@item.Priority</span>
                                                            }
                                                            else if (item.Priority.Trim().ToUpper() == "HIGH")
                                                            {
                                                                <span class="bg-label-orange">@item.Priority</span>
                                                            }
                                                            else
                                                            {
                                                                <span class="bg-label-red">@item.Priority</span>
                                                            }


                                                        </td>
                                                        <td>@item.StartDate</td>
                                                        <td>@item.EndDate</td>
                                                        <td>@item.Duration</td>
                                                        <td>
                                                            @if (item.Status.Trim().ToUpper() == "OPEN TASKS")
                                                            {
                                                                <span class="badge bg-label-danger">@item.Status</span>
                                                            }
                                                            else if (item.Status.Trim().ToUpper() == "OVERDUE")
                                                            {
                                                                <span class="badge bg-label-danger">@item.Status</span>
                                                            }
                                                            else if (item.Status.Trim().ToUpper() == "IN PROGRESS")
                                                            {
                                                                <span class="badge bg-label-warning">@item.Status</span>
                                                            }
                                                            else
                                                            {
                                                                <span class="badge  bg-label-success">@item.Status</span>
                                                            }
                                                        </td>
                                                       
                                                        <td>@item.CreatedBy</td>
                                                        <td>@item.CreatedOn</td>

                                                        <td>
                                                            <a href="/Task/TaskView/@item.eTaskId"><i class="fa fa-eye text-success me-1"></i></a>


                                                            @if ((Model.AccessList.Where(x => x.IsView == true && x.ModuleCode.Trim() == "T").Count() > 0) || Model.UserType == 0)
                                                            {
                                                                <a href="/Task/GetTaskId/@item.eTaskId"><i class="fa fa-edit text-primary me-1"></i></a>
                                                            }
                                                            @if ((Model.AccessList.Where(x => x.IsView == true && x.ModuleCode.Trim() == "T").Count() > 0) || Model.UserType == 0)
                                                            {
                                                                <a href="#" onclick="DeleteTaskConfirmation('@item.eTaskId')"><i class="fa fa-trash text-danger me-1"></i></a>
                                                            }



                                                        </td>
                                                    </tr>
                                                    iCtr++;
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <!-- Phase Four -->
                        <div class="accordion-item">
                            <h2 class="accordion-header text-body d-flex justify-content-between" id="accordionCustomIconFour">
                                <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse"
                                        data-bs-target="#phase-four" aria-controls="phase-four">
                                    Monitoring and Control
                                </button>
                            </h2>
                            <div id="phase-four" class="accordion-collapse collapse show" data-bs-parent="#accordionCustomIcon">
                                <div class="accordion-body">
                                    <!-- Table content duplicated from Phase One -->
                                    <table class="project-datatable table">
                                        <thead>
                                            <tr>
                                                <th>Sr.No</th>
                                                <th>Task Name</th>
                                                <th>Owner</th>
                                                <th>Vendor</th>
                                                <th>Phase</th>
                                                <th>Priority</th>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Duration</th>
                                                <th>Status</th>
                                                <th>Created By</th>
                                                <th>Created On</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (Model.ProjectTaskList != null)
                                            {
                                                int iCtr = 1;
                                                @foreach (var item in Model.ProjectTaskList.Where(x => x.PhaseId == 4))
                                                {
                                                    <tr>
                                                        <td>@iCtr</td>
                                                        <td>
                                                            <div class="d-flex gap-2 ">
                                                                <span>@item.TaskName</span>
                                                                <div class="action-button hover-action-button ms-auto">
                                                                    <a href="/Task/GetTaskView/@item.eTaskId" class="btn btn-outline-primary waves-effect">

                                                                        <i class="fa fa-eye me-1"></i> View
                                                                    </a>
                                                                </div>

                                                            </div>

                                                        </td>
                                                        <td>
                                                            @(item.TaskOwner == null ? "NA" : item.TaskOwner)
                                                        </td>
                                                        <td>
                                                            @(item.Vendor == null ? "NA" : item.Vendor)
                                                        </td>
                                                        <td>@item.Phase</td>
                                                        <td>
                                                            @if (item.Priority.Trim().ToUpper() == "LOW")
                                                            {
                                                                <span class="bg-label-green">@item.Priority</span>
                                                            }
                                                            else if (item.Priority.Trim().ToUpper() == "NORMAL")
                                                            {
                                                                <span class="bg-label-blue">@item.Priority</span>
                                                            }
                                                            else if (item.Priority.Trim().ToUpper() == "HIGH")
                                                            {
                                                                <span class="bg-label-orange">@item.Priority</span>
                                                            }
                                                            else
                                                            {
                                                                <span class="bg-label-red">@item.Priority</span>
                                                            }


                                                        </td>
                                                        <td>@item.StartDate</td>
                                                        <td>@item.EndDate</td>
                                                        <td>@item.Duration</td>
                                                        <td>
                                                            @if (item.Status.Trim().ToUpper() == "OPEN TASKS")
                                                            {
                                                                <span class="badge bg-label-danger">@item.Status</span>
                                                            }
                                                            else if (item.Status.Trim().ToUpper() == "OVERDUE")
                                                            {
                                                                <span class="badge bg-label-danger">@item.Status</span>
                                                            }
                                                            else if (item.Status.Trim().ToUpper() == "IN PROGRESS")
                                                            {
                                                                <span class="badge bg-label-warning">@item.Status</span>
                                                            }
                                                            else
                                                            {
                                                                <span class="badge  bg-label-success">@item.Status</span>
                                                            }
                                                        </td>
                                                       
                                                        <td>@item.CreatedBy</td>
                                                        <td>@item.CreatedOn</td>

                                                        <td>
                                                            <a href="/Task/TaskView/@item.eTaskId"><i class="fa fa-eye text-success me-1"></i></a>


                                                            @if ((Model.AccessList.Where(x => x.IsView == true && x.ModuleCode.Trim() == "T").Count() > 0) || Model.UserType == 0)
                                                            {
                                                                <a href="/Task/GetTaskId/@item.eTaskId"><i class="fa fa-edit text-primary me-1"></i></a>
                                                            }
                                                            @if ((Model.AccessList.Where(x => x.IsView == true && x.ModuleCode.Trim() == "T").Count() > 0) || Model.UserType == 0)
                                                            {
                                                                <a href="#" onclick="DeleteTaskConfirmation('@item.eTaskId')"><i class="fa fa-trash text-danger me-1"></i></a>
                                                            }



                                                        </td>
                                                    </tr>
                                                    iCtr++;
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <!-- Phase Four -->
                        <div class="accordion-item">
                            <h2 class="accordion-header text-body d-flex justify-content-between" id="accordionCustomIconFour">
                                <button type="button" class="accordion-button collapsed" data-bs-toggle="collapse"
                                        data-bs-target="#phase-five" aria-controls="phase-five">
                                    Project Closure and Handover
                                </button>
                            </h2>
                            <div id="phase-five" class="accordion-collapse collapse show" data-bs-parent="#accordionCustomIcon">
                                <div class="accordion-body">
                                    <!-- Table content duplicated from Phase One -->
                                    <table class="project-datatable table">
                                        <thead>
                                            <tr>
                                                <th>Sr.No</th>
                                                <th>Task Name</th>
                                                <th>Owner</th>
                                                <th>Vendor</th>
                                                <th>Phase</th>
                                                <th>Priority</th>
                                                <th>Start Date</th>
                                                <th>End Date</th>
                                                <th>Duration</th>
                                                <th>Status</th>
                                                <th>Created By</th>
                                                <th>Created On</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            @if (Model.ProjectTaskList != null)
                                            {
                                                int iCtr = 1;
                                                @foreach (var item in Model.ProjectTaskList.Where(x => x.PhaseId == 5))
                                                {
                                                    <tr>
                                                        <td>@iCtr</td>
                                                        <td>
                                                            <div class="d-flex gap-2 ">
                                                                <span>@item.TaskName</span>
                                                                <div class="action-button hover-action-button ms-auto">
                                                                    <a href="/Task/GetTaskView/@item.eTaskId" class="btn btn-outline-primary waves-effect">

                                                                        <i class="fa fa-eye me-1"></i> View
                                                                    </a>
                                                                </div>

                                                            </div>

                                                        </td>
                                                        <td>
                                                            @(item.TaskOwner == null ? "NA" : item.TaskOwner)
                                                        </td>
                                                        <td>
                                                            @(item.Vendor == null ? "NA" : item.Vendor)
                                                        </td>
                                                        <td>@item.Phase</td>
                                                        <td>
                                                            @if (item.Priority.Trim().ToUpper() == "LOW")
                                                            {
                                                                <span class="bg-label-green">@item.Priority</span>
                                                            }
                                                            else if (item.Priority.Trim().ToUpper() == "NORMAL")
                                                            {
                                                                <span class="bg-label-blue">@item.Priority</span>
                                                            }
                                                            else if (item.Priority.Trim().ToUpper() == "HIGH")
                                                            {
                                                                <span class="bg-label-orange">@item.Priority</span>
                                                            }
                                                            else
                                                            {
                                                                <span class="bg-label-red">@item.Priority</span>
                                                            }


                                                        </td>
                                                        <td>@item.StartDate</td>
                                                        <td>@item.EndDate</td>
                                                        <td>@item.Duration</td>
                                                        <td>
                                                            @if (item.Status.Trim().ToUpper() == "OPEN TASKS")
                                                            {
                                                                <span class="badge bg-label-danger">@item.Status</span>
                                                            }
                                                            else if (item.Status.Trim().ToUpper() == "OVERDUE")
                                                            {
                                                                <span class="badge bg-label-danger">@item.Status</span>
                                                            }
                                                            else if (item.Status.Trim().ToUpper() == "IN PROGRESS")
                                                            {
                                                                <span class="badge bg-label-warning">@item.Status</span>
                                                            }
                                                            else
                                                            {
                                                                <span class="badge  bg-label-success">@item.Status</span>
                                                            }
                                                        </td>
                                                       
                                                        <td>@item.CreatedBy</td>
                                                        <td>@item.CreatedOn</td>

                                                        <td>
                                                            <a href="/Task/TaskView/@item.eTaskId"><i class="fa fa-eye text-success me-1"></i></a>


                                                            @if ((Model.AccessList.Where(x => x.IsView == true && x.ModuleCode.Trim() == "T").Count() > 0) || Model.UserType == 0)
                                                            {
                                                                <a href="/Task/GetTaskId/@item.eTaskId"><i class="fa fa-edit text-primary me-1"></i></a>
                                                            }
                                                            @if ((Model.AccessList.Where(x => x.IsView == true && x.ModuleCode.Trim() == "T").Count() > 0) || Model.UserType == 0)
                                                            {
                                                                <a href="#" onclick="DeleteTaskConfirmation('@item.eTaskId')"><i class="fa fa-trash text-danger me-1"></i></a>
                                                            }



                                                        </td>
                                                    </tr>
                                                    iCtr++;
                                                }
                                            }
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div> *@

                    </div>
                </div>
            </div>

            <!--/ DataTable with Buttons -->

            <div class="offcanvas offcanvas-end" id="add-new-task">
                <div class="offcanvas-header border-bottom">
                    <h5 class="offcanvas-title" id="exampleModalLabel">Task Details</h5>
                    <button type="button" class="btn-close text-reset text-danger" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body flex-grow-1">
                    <form class="add-new-record pt-0 new-forms row g-2" id="form-add-new-record" method="post" action="/Task/SaveTask" enctype="multipart/form-data">



                        <!-- Task Name -->
                        <div class="col-sm-12 mt-0">
                            <div class="new-input-box">
                                <div class="main-input input-group-merge">
                                    <input type="text" id="TaskName" class="form-control" name="TaskName" value="@Model.TaskName"
                                           placeholder="Enter Task Name" required aria-label="Task Name" aria-describedby="basicFullname2" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="new-input-box">
                                <label class="form-label mb-0" for="projectPhase">Project</label>
                                <select name="ProjectId" id="projectName" required class="form-select select2 dt-email">
                                    @if (Model.ProjectList != null)
                                    {
                                        <option value=""> Select</option>
                                        @foreach (var item in Model.ProjectList)
                                        {
                                            if (item.ProjectId == Model.ProjectId)
                                            {
                                                <option value="@item.ProjectId" selected>@item.ProjectName </option>


                                            }
                                            else
                                            {
                                                <option value="@item.ProjectId">@item.ProjectName </option>
                                            }
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <!-- Start Date -->
                        <div class="col-md-12">
                            <div class="new-input-box">
                                <label class="form-label mb-0" for="start-date">Start Date</label>
                                <span class=""><i class="fas fa-calendar-alt"></i></span>
                                <input type="date" id="start-date" required class="form-control date-picker" placeholder="20, March 2025" name="StartDate" value="@(Model.StartDate ==null?@Model.StartDate:@Model.StartDate.Value.ToString("yyyy-MM-dd"))" onchange="StDate(event);" />
                            </div>
                        </div>

                        <!-- Start Date -->
                        <div class="col-md-12">
                            <div class="new-input-box">
                                <label class="form-label mb-0" for="due-date">End Date</label>
                                <span class=""><i class="fas fa-calendar-alt"></i></span>
                                <input type="date" id="due-date" required class="form-control date-picker" placeholder="23, March 2025" name="EndDate" value="@(Model.EndDate ==null?@Model.EndDate:@Model.EndDate.Value.ToString("yyyy-MM-dd"))" onchange="EDate(event);" />
                            </div>
                        </div>

                        <!-- Priority -->
                        <div class="col-md-12">
                            <div class="new-input-box">
                                <label class="form-label mb-0" for="priority">Priority</label>
                                <select name="PriorityId" id="priority" onchange="javascript:PopulatePriority()" required class="form-select select2">
                                    @if (Model.PriorityList != null)
                                    {
                                        <option value=""> Select</option>
                                        @foreach (var item in Model.PriorityList)
                                        {
                                            if (item.CompanyPriorityId == Model.PriorityId)
                                            {
                                                <option value="@item.CompanyPriorityId" selected>@item.CompanyPriority </option>


                                            }
                                            else
                                            {
                                                <option value="@item.CompanyPriorityId">@item.CompanyPriority </option>
                                            }
                                        }
                                    }
                                </select>
                            </div>
                        </div>

                        <!-- Status -->
                        <div class="col-md-12">
                            <div class="new-input-box">
                                <label class="form-label mb-0" for="basicEmail">Status</label>
                                <select name="StatusId" id="StatusId" onchange="javascript:PopulateStatus()" required class="form-select select2 dt-email">
                                    @if (Model.StatusList != null)
                                    {
                                        <option value=""> Select</option>
                                        @foreach (var item in Model.StatusList)
                                        {
                                            if (item.ID == Model.StatusId)
                                            {
                                                <option value="@item.ID" selected>@item.Status </option>
                                            }
                                            else
                                            {
                                                <option value="@item.ID">@item.Status </option>
                                            }
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <!-- Phase -->
                        <div class="col-md-12">
                            <div class="new-input-box">
                                <label class="form-label mb-0" for="projectPhase">Phase</label>
                                <select name="PhaseId" id="projectPhase" onchange="javascript:PopulatePhase()" required class="form-select select2 dt-email">
                                    @if (Model.PhaseList != null)
                                    {
                                        <option value=""> Select</option>
                                        @foreach (var item in Model.PhaseList)
                                        {
                                            if (item.ID == Model.PhaseId)
                                            {
                                                <option value="@item.ID" selected>@item.Phase </option>


                                            }
                                            else
                                            {
                                                <option value="@item.ID">@item.Phase </option>
                                            }
                                        }
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-md-12">
                            <div class="new-input-box align-items-center">
                                <label class="form-label" for="">Assign to</label>
                               <div class="d-flex gx-4 flex-wrap">
                                    <div class="form-check form-check-inline">
                                    <input name="assign-to"
                                           class="form-check-input"
                                           type="radio"
                                           value="inhouse"
                                           id="assign-to-inhouse"
                                           checked />
                                    <label class="form-check-label" for="assign-to-inhouse">In-house Team</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input name="assign-to"
                                           class="form-check-input"
                                           type="radio"
                                           value="vendor"
                                           id="assign-to-vendor" />
                                    <label class="form-check-label" for="assign-to-vendor">Vendor / Contractor</label>
                                </div>

</div>
                            </div>
                        </div>

                        <!-- Vendor List -->
                        <div class="col-md-12" id="vendor-list" style="display: none;">
                            <div class="new-input-box">
                                <label class="form-label" for="vendorList">Vendor List</label>
                                <select name="VendorId" id="vendorList" onchange="javascript:PopulateVendor()" class="form-select select2 dt-email">
                                    @if (Model.VendorList != null)
                                    {
                                        <option value=""> Select</option>
                                        @foreach (var item in Model.VendorList)
                                        {
                                            if (item.UserId == Model.VendorId)
                                            {
                                                <option value="@item.UserId" selected> @item.FullName</option>
                                            }
                                            else
                                            {
                                                <option value="@item.UserId"> @item.FullName</option>
                                            }
                                        }
                                        <option value="0"> NA</option>
                                    }
                                </select>
                            </div>

                        </div>

                        <!-- Assigned To -->
                        <div class="col-md-12">
                            <div class="new-input-box">
                                <label for="TagifyUserList" class="form-label mb-0">Task Owner</label>
                                @* <input id="TagifyUserList" name="TaskOwnerId" class="form-control" placeholder="Project Owner" value="" /> *@

                                <select name="TaskOwnerId" id="TaskOwnerId" onchange="javascript:PopulateUser()" required class="form-select select2">
                                    @if (Model.UserList != null)
                                    {
                                        <option value=""> Select</option>
                                        @foreach (var item in Model.UserList)
                                        {
                                            if (item.UserId == Model.TaskOwnerId)
                                            {
                                                <option value="@item.UserId" selected> @item.FullName</option>
                                            }
                                            else
                                            {
                                                <option value="@item.UserId"> @item.FullName</option>
                                            }
                                        }
                                        <option value="0"> NA</option>
                                    }
                                </select>
                            </div>
                        </div>




                        <!-- Assigned To -->
                        <div class="col-md-12 mb-4">
                            <div class="new-input-box">
                                <label for="TagifyUserList" class="form-label mb-0">Collaborators</label>
                                <select id="TaskCollaborators" name="SelCollaborators" onchange="javascript:GetTaskCollaboration()" class="select2 form-select" multiple>
                                    @{
                                        string[] collaborators = Model.Collaborators == null ? null : Model.Collaborators.Split(",");
                                        if (Model.UserList != null)
                                        {

                                            foreach (var item in Model.UserList)
                                            {
                                                if (collaborators != null)
                                                {
                                                    if (collaborators.Contains(item.UserId.ToString()))
                                                    {

                                                            <option value="@item.UserId" selected>
                                                                @(item.FullName != null ? item.FullName : item.BusinessOwner)
                                                            </option>
                                                    }
                                                    else
                                                    {
                                                            <option value="@item.UserId">
                                                                @(item.FullName != null ? item.FullName : item.BusinessOwner)
                                                            </option>
                                                        // <option value="@item.UserId">
                                                        //     @(item.FullName != null ? item.FullName : item.BusinessOwner)
                                                        // </option>
                                                    }
                                                }
                                                else
                                                {
                                                        <option value="@item.UserId" data-img="@item.Base64ProfileImage">
                                                            @(item.FullName != null ? item.FullName : item.BusinessOwner)
                                                        </option>
                                                    // <option value="@item.UserId">
                                                    //     @(item.FullName != null ? item.FullName : item.BusinessOwner)
                                                    // </option>
                                                }
                                            }
                                        }
                                    }
                                </select>

                            </div>
                        </div>

                        <!-- Task Description -->
                        <div class="col-md-12 mb-2">
                            <label class="form-label fw-bold mt-2" for="project-description">Description</label>
                            @*    <div id="summernote"></div> *@
                            <textarea class="summernote-editor" name="Description">@Model.Description
                            </textarea>
                        </div>

                        <!-- Attachment -->
                         <div class="col-md-12">
                            <label class="form-label" for="profileImageInput">File Upload</label>
                            <input type="file" id="profileImageInput" class="form-control border" name="profileImageInput" />
                        </div>

                        <!-- Submit & Cancel Buttons -->
                        <div class="col-sm-12">
                            <input type="hidden" id="TCollaborators" name="Collaborators" class="form-control" value="@Model.Collaborators" />
                            <input type="hidden" id="ProjectId" name="ProjectId" class="form-control" value="@Model.ProjectId" />
                            <input type="hidden" id="TaskId" name="TaskId" class="form-control" value="@Model.TaskId" />
                            <button type="submit" class="btn btn-primary data-submit me-sm-4 me-1" onclick="SaveUserActivities(@Model.TaskId);">Submit</button>
                            <button type="reset" class="btn btn-outline-secondary" data-bs-dismiss="offcanvas">Cancel</button>
                        </div>

                    </form>


                </div>
            </div>



        </div>
        <div class="offcanvas offcanvas-end" id="view-record">
            <div class="offcanvas-header border-bottom">
                <h5 class="offcanvas-title" id="exampleModalLabel">
                    View Full Page <a href="~/Task/TaskView/@Model.EncryptedId">
                        <i class="fa fa-external-link ms-2"></i>
                    </a>
                </h5>
                <button type="button" class="btn-close text-reset text-danger" data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
                <div class="row">



                    <div class="col-lg-12 col-md-12 mb-lg-0 mb-3">

                        <!-- <div class="content-right"> -->
                        <!-- <div class="card"> -->
                        <div class="card-body">
                            <div class="content-body">
                                <!-- overlay container -->


                                <div class="row">
                                    <div class="col-12">

                                        <div class="file-manager-content-body">
                                            <!-- drives area starts-->
                                            <div class="drives">
                                                <div class="row">
                                                    <div class="flex-grow-1">
                                                        <form class="add-new-record pt-0 new-forms row g-2" method="post" action="/Task/SaveTask">



                                                            <!-- Task Name -->
                                                            <div class="col-sm-12 mt-0">
                                                                <div class="new-input-box">
                                                                    <div class="main-input input-group-merge">
                                                                        <input type="text" id="TaskName" class="form-control" name="TaskName" value="@Model.TaskName"
                                                                               placeholder="Enter Task Name" required aria-label="Task Name" aria-describedby="basicFullname2" />
                                                                    </div>
                                                                </div>
                                                            </div>


                                                            <!-- Start Date -->
                                                            <div class="col-sm-4">
                                                                <div class="new-input-box upper-box">
                                                                    <label class="form-label mb-0" for="start-date">Start Date</label><br>
                                                                    <div class="d-flex align-items-center">
                                                                        <i class="fas fa-calendar-alt me-2"></i>
                                                                        <input type="date" id="startdate" required class="form-control date-picker" placeholder="20, March 2025" name="StartDate" value="@(Model.StartDate ==null?@Model.StartDate:@Model.StartDate.Value.ToString("yyyy-MM-dd"))" />
                                                                        @*   <input type="date" id="start-date" class="form-control custom-date"
                                                                        name="startDate" value="2025-03-20" value="@(Model.StartDate ==null?@Model.StartDate:@Model.StartDate.Value.ToString("yyyy-MM-dd"))" /> *@
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <!-- Duration -->
                                                            <span class="col-sm-4">
                                                                <div class="new-input-box upper-box">
                                                                    <label class="form-label" for="duration">Duration (Days)</label>
                                                                    <input type="text" id="duration" class="form-control" name="duration"
                                                                           placeholder="3 days" readonly />
                                                                </div>
                                                            </span>

                                                            <!-- End Date -->
                                                            <div class="col-sm-4">
                                                                <div class="new-input-box upper-box">
                                                                    <label class="form-label mb-0" for="due-date">End Date</label><br>
                                                                    <div class="d-flex align-items-center">
                                                                        <i class="fas fa-calendar-alt me-2"></i>
                                                                        <input type="date" id="duedate" required class="form-control date-picker" placeholder="20, March 2025" name="StartDate" value="@(Model.EndDate ==null?@Model.EndDate:@Model.EndDate.Value.ToString("yyyy-MM-dd"))" />
                                                                        @*  <input type="date" id="due-date" class="form-control custom-date"
                                                                        name="endDate" value="2025-03-23" value="@(Model.EndDate ==null?@Model.EndDate:@Model.EndDate.Value.ToString("yyyy-MM-dd"))" /> *@
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="progress mt-2">
                                                                <div id="progress-bar" class="progress-bar bg-success" role="progressbar"
                                                                     style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                                                </div>
                                                            </div>



                                                            <div class="col-md-12">
                                                                <div class="new-input-box">
                                                                    <label class="form-label mb-0" for="priority">Priority</label>
                                                                    <select name="PriorityId" id="priority" onchange="javascript:PopulatePriority()" required class="form-select select2">
                                                                        @if (Model.PriorityList != null)
                                                                        {
                                                                            <option value=""> Select</option>
                                                                            @foreach (var item in Model.PriorityList)
                                                                            {
                                                                                if (item.CompanyPriorityId == Model.PriorityId)
                                                                                {
                                                                                    <option value="@item.CompanyPriorityId" selected>@item.CompanyPriority </option>


                                                                                }
                                                                                else
                                                                                {
                                                                                    <option value="@item.CompanyPriorityId">@item.CompanyPriority </option>
                                                                                }
                                                                            }
                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>

                                                            <!-- Status -->
                                                            <div class="col-md-12">
                                                                <div class="new-input-box">
                                                                    <label class="form-label mb-0" for="basicEmail">Status</label>
                                                                    <select name="StatusId" id="StatusId" onchange="javascript:PopulateStatus()" required class="form-select select2 dt-email">
                                                                        @if (Model.StatusList != null)
                                                                        {
                                                                            <option value=""> Select</option>
                                                                            @foreach (var item in Model.StatusList)
                                                                            {
                                                                                if (item.ID == Model.StatusId)
                                                                                {
                                                                                    <option value="@item.ID" selected>@item.Status </option>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <option value="@item.ID">@item.Status </option>
                                                                                }
                                                                            }
                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <!-- Phase -->
                                                            <div class="col-md-12">
                                                                <div class="new-input-box">
                                                                    <label class="form-label mb-0" for="projectPhase">Phase</label>
                                                                    <select name="PhaseId" id="projectPhase" onchange="javascript:PopulatePhase()" required class="form-select select2 dt-email">
                                                                        @if (Model.PhaseList != null)
                                                                        {
                                                                            <option value=""> Select</option>
                                                                            @foreach (var item in Model.PhaseList)
                                                                            {
                                                                                if (item.ID == Model.PhaseId)
                                                                                {
                                                                                    <option value="@item.ID" selected>@item.Phase </option>


                                                                                }
                                                                                else
                                                                                {
                                                                                    <option value="@item.ID">@item.Phase </option>
                                                                                }
                                                                            }
                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>
                                                            <div class="col-md-12">
                                                                <div class="new-input-box">
                                                                    <label class="form-label" for="">Assign to</label>
                                                                    <div class="form-check form-check-inline">
                                                                        <input name="assign-to"
                                                                               class="form-check-input"
                                                                               type="radio"
                                                                               value="inhouse"
                                                                               id="assign-to-inhouse"
                                                                               checked />
                                                                        <label class="form-check-label" for="assign-to-inhouse">In-house Team</label>
                                                                    </div>
                                                                    <div class="form-check form-check-inline">
                                                                        <input name="assign-to"
                                                                               class="form-check-input"
                                                                               type="radio"
                                                                               value="vendor"
                                                                               id="assign-to-vendor" />
                                                                        <label class="form-check-label" for="assign-to-vendor">Vendor / Contractor</label>
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <!-- Vendor List -->
                                                            <div class="col-md-12" id="vendor-list" style="display: none;">
                                                                <div class="new-input-box">
                                                                    <label class="form-label" for="vendorList">Vendor List</label>
                                                                    <select name="VendorId" id="vendorList" onchange="javascript:PopulateVendor()" class="form-select select2 dt-email">
                                                                        @if (Model.VendorList != null)
                                                                        {
                                                                            <option value=""> Select</option>
                                                                            @foreach (var item in Model.VendorList)
                                                                            {
                                                                                if (item.UserId == Model.VendorId)
                                                                                {
                                                                                    <option value="@item.UserId" selected> @item.FullName</option>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <option value="@item.UserId"> @item.FullName</option>
                                                                                }
                                                                            }
                                                                            <option value="0"> NA</option>
                                                                        }
                                                                    </select>
                                                                </div>

                                                            </div>

                                                            <!-- Assigned To -->
                                                            <div class="col-md-12">
                                                                <div class="new-input-box">
                                                                    <label for="TagifyUserList" class="form-label mb-0">Task Owner</label>
                                                                    @* <input id="TagifyUserList" name="TaskOwnerId" class="form-control" placeholder="Project Owner" value="" /> *@

                                                                    <select name="TaskOwnerId" id="TaskOwnerId" onchange="javascript:PopulateUser()" required class="form-select select2">
                                                                        @if (Model.UserList != null)
                                                                        {
                                                                            <option value=""> Select</option>
                                                                            @foreach (var item in Model.UserList)
                                                                            {
                                                                                if (item.UserId == Model.TaskOwnerId)
                                                                                {
                                                                                    <option value="@item.UserId" selected> @item.FullName</option>
                                                                                }
                                                                                else
                                                                                {
                                                                                    <option value="@item.UserId"> @item.FullName</option>
                                                                                }
                                                                            }
                                                                            <option value="0"> NA</option>
                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>




                                                            <!-- Assigned To -->
                                                            <div class="col-md-12 mb-4">
                                                                <div class="new-input-box">
                                                                    <label for="TagifyUserList" class="form-label mb-0">Collaborators</label>
                                                                    <select id="selCollaborators" name="SelCollaborators" onchange="javascript:GetCollaboration()" class="select2 form-select" multiple>
                                                                        @{
                                                                            string[] collaboratorsView = Model.Collaborators == null ? null : Model.Collaborators.Split(",");
                                                                            if (Model.UserList != null)
                                                                            {

                                                                                foreach (var item in Model.UserList)
                                                                                {
                                                                                    if (collaboratorsView != null)
                                                                                    {
                                                                                        if (collaboratorsView.Contains(item.UserId.ToString()))
                                                                                        {
                                                                                                <option value="@item.UserId" selected>
                                                                                                    @(item.FullName != null ? item.FullName : item.BusinessOwner)
                                                                                                </option>
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                                <option value="@item.UserId">
                                                                                                    @(item.FullName != null ? item.FullName : item.BusinessOwner)
                                                                                                </option>
                                                                                        }
                                                                                    }
                                                                                    else
                                                                                    {
                                                                                            <option value="@item.UserId">
                                                                                                @(item.FullName != null ? item.FullName : item.BusinessOwner)
                                                                                            </option>
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    </select>

                                                                </div>
                                                            </div>

                                                            <!-- Task Description -->
                                                            <div class="col-md-12 mb-2">
                                                                <label class="form-label fw-bold mt-2" for="project-description">
                                                                           Description
                                                                </label>

                                                                <textarea class="summernote-editor" id="edit" name="Description">@Model.Description</textarea>
                                                            </div>


                                                            <!-- File Upload Section -->
                                                           @*  <div class="col-md-12">
                                                                <label class="form-label">Upload Project Photos</label>
                                                                <div class="Documents-container mt-2">
                                                                    <div class="document-item">
                                                                        <div class="hover-buttons">
                                                                            <button type="button" class="btn btn-hover" data-bs-toggle="modal"
                                                                                    data-bs-target="#invitemember">
                                                                                <i class="fa fa-share" data-bs-toggle="tooltip" title="Share"></i>
                                                                            </button>
                                                                            <button type="button" class="btn btn-hover">
                                                                                <i class="fa fa-eye" data-bs-toggle="tooltip" title="View"></i>
                                                                            </button>
                                                                            <button type="button" class="btn btn-hover" data-bs-toggle="modal"
                                                                                    data-bs-target="#deleteModal">
                                                                                <i class="fa fa-trash" data-bs-toggle="tooltip" title="Delete"></i>
                                                                            </button>
                                                                            <button type="button" class="btn btn-hover">
                                                                                <i class="fab fa-whatsapp" data-bs-toggle="tooltip"
                                                                                   title="WhatsApp"></i>
                                                                            </button>
                                                                        </div>
                                                                        <div class="document-icon">
                                                                            <img id="uploaded-image"
                                                                                 src="https://plus.unsplash.com/premium_photo-1681989486976-9ec9d2eac57a?w=500&auto=format&fit=crop&q=60"
                                                                                 alt="Project Image">
                                                                        </div>
                                                                        <div class="document-content">
                                                                            <h2 class="document-title">Construction Agreement</h2>
                                                                        </div>
                                                                        <input type="file" id="fileUpload" class="form-control border mt-2"
                                                                               name="fileUpload" accept="image/*" onchange="previewImage(event)" />
                                                                    </div>


                                                                </div>

                                                            </div> *@

                                                            <!-- Submit & Cancel Buttons -->
                                                            <div class="col-sm-12 text-end">
                                                                <input type="hidden" id="Collaborators" name="Collaborators" class="form-control" value="@Model.Collaborators" />
                                                                <input type="hidden" id="TaskProjectId" name="ProjectId" class="form-control" value="@Model.ProjectId" />
                                                                <input type="hidden" id="TaskId" name="TaskId" class="form-control" value="@Model.TaskId" />
                                                                <button type="submit"
                                                                        class="btn btn-primary btn-new data-submit me-sm-4 me-1">
                                                                    Save
                                                                </button>
                                                            </div>

                                                        </form>
                                                    </div>
                                                </div>
                                                <!-- Start Date -->



                                            </div>
                                        </div>


                                        <!-- drives area ends-->
                                        <!-- tabs -->



                                        <div class="row mt-5">
                                            <div class="col-12 mt-2">

                                                <ul class="nav nav-tabs tab-top-new tabs px-3 bg-light-theme" role="tablist">
                                                    <li class="nav-item">
                                                        <a class="nav-link new-link active" id="home-tab" data-bs-toggle="tab"
                                                           href="#divComments" aria-controls="home" role="tab"
                                                           aria-selected="true">Comments</a>
                                                    </li>
                                                    <li class="nav-item">
                                                        <a class="nav-link new-link " id="profile-tab" data-bs-toggle="tab"
                                                           href="#subtasks" aria-controls="profile" role="tab"
                                                           aria-selected="false">Subtasks</a>
                                                    </li>

                                                   @*  <li class="nav-item">
                                                        <a class="nav-link new-link " id="about-tab" data-bs-toggle="tab" href="#issues"
                                                           aria-controls="about" role="tab" aria-selected="false">Issues</a>
                                                    </li> *@

                                                    <li class="nav-item">
                                                        <a class="nav-link new-link " id="about-tab" data-bs-toggle="tab"
                                                           href="#activities" aria-controls="about" role="tab"
                                                           aria-selected="false">Activities</a>
                                                    </li>

                                                </ul>

                                            </div>
                                        </div>





                                        <div class="tab-content task-tabs rounded-3">
                                            <div class="tab-pane active" id="divComments" aria-labelledby="home-tab" role="tabpanel">
                                                <!-- Task Description -->
                                                <div class="col-md-12 position-relative ">
                                                    <div class="textarea-container">
                                                        <textarea name="comments" placeholder="Type something..." id="comments" rows="4"
                                                                  class="w-100 p-2 border"></textarea>

                                                        <!-- Submit Button Inside Textarea -->
                                                        <button type="button" class="btn btn-primary btn-new submit-btn  waves-effect waves-light" onclick="SaveComments()">
                                                            <span>Submit</span>
                                                        </button>
                                                    </div>
                                                </div>
                                                <!-- Task Description -->
                                                <div class="col-md-12 mt-5" id="divChat">
                                                </div>
                                            </div>

                                            <div class="tab-pane" id="subtasks" aria-labelledby="profile-tab" role="tabpanel">
                                                <div class=" flex-grow-1">
                                                    <div class="card">
                                                        <div class="card-datatable table-responsive pt-0">
                                                            <div class="d-flex justify-content-between align-items-center mt-3 mb-2">
                                                                <div>
                                                                    <h5 class="card-title mb-0">Sub Task</h5>
                                                                </div>
                                                                <button class="btn btn-primary" data-bs-toggle="offcanvas" data-bs-target="#add-new-subtask">
                                                                    <i class="fa fa-plus me-1"></i> Add New Subtask
                                                                </button>
                                                            </div>

                                                            <table class="project-datatable table">
                                                                <thead>
                                                                    <tr>
                                                                        <th>Sr.No</th>
                                                                        <th>Subtask Name</th>
                                                                        <th>Owner</th>
                                                                        <th>Priority</th>
                                                                        <th>Status</th>
                                                                        <th>Start Date</th>
                                                                        <th>End Date</th>
                                                                        <th>Duration</th>
                                                                        <th>Created By</th>
                                                                        <th>Created On</th>
                                                                        <th>Action</th>

                                                                    </tr>
                                                                </thead>
                                                                <tbody id="mycountrytbl">
                                                                </tbody>

                                                            </table>
                                                        </div>
                                                    </div>






                                                </div>

                                            </div>


                                            <div class="tab-pane" id="issues" aria-labelledby="about-tab" role="tabpanel">
                                                <p>
                                                    Comming Soon....
                                                </p>

                                            </div>
                                            <div class="tab-pane" id="activities" aria-labelledby="about-tab" role="tabpanel">
                                                <!-- ----timeline------  -->
                                                <div class="card">
                                                    <div class="card-body">
                                                        <ul class="timeline mb-0">
                                                            @if (Model.ActivityList != null)
                                                            {

                                                                @foreach (var item in Model.ActivityList)
                                                                {
                                                                    <li class="timeline-item timeline-item-transparent">
                                                                        <span class="timeline-point timeline-point-success"></span>
                                                                        <div class="timeline-event">
                                                                            <div class="timeline-header mb-3">
                                                                                <h6 class="mb-0">@item.TaskName</h6>
                                                                                <small class="text-muted">@item.CreationDate</small>
                                                                            </div>
                                                                            <p class="mb-2">@item.FullName: @item.Comments</p>
                                                                            <div class="d-flex justify-content-between flex-wrap gap-2 mb-2">
                                                                                <div class="d-flex flex-wrap align-items-center mb-50">
                                                                                    <div class="avatar avatar-sm me-2">
                                                                                        @if (item.ProfileName!=null)
                                                                                        {
                                                                                             <img src="~/Profile/@item.ProfileName" alt="Avatar" class="rounded-circle" />
                                                                                        }
                                                                                        else
                                                                                        {
                                                                                            <img src="~/Profile/user-default.png" alt="Avatar" class="rounded-circle" />
                                                                                        }
                                                                                       
                                                                                    </div>
                                                                                    <div>
                                                                                        <p class="mb-0 small fw-medium">@item.FullName</p>
                                                                                        @*   <small>CEO of Pixinvent</small> *@
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                }
                                                            }

                                                        </ul>
                                                    </div>
                                                    </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                            </div>

                        </div>




                        <!-- </div> -->
                    </div>





                </div>





            </div>
        </div>

        <div class="offcanvas offcanvas-end" id="view-data">

            <div class="offcanvas-header border-bottom">
                <h5 class="offcanvas-title d-flex align-items-center gap-2" id="exampleModalLabel">
                    <i class="fa fa-chevron-left text-primary backToViewRecord" role="button"
                       style="cursor:pointer;"></i>
                    <strong>Task</strong>
                </h5>
                <button type="button" class="btn-close text-reset text-danger" data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
            </div>

            <div class="offcanvas-body">
                <div class="row">

                    <div class="col-lg-12 col-md-12 mb-lg-0 mb-3">

                        <div class="card-body">
                            <div class="content-body">
                                <!-- overlay container -->
                                <div class="row">
                                    <div class="col-12">

                                        <div class="file-manager-content-body">
                                            <!-- drives area starts-->
                                            <div class="drives">
                                                <div class="row">
                                                    <div class="flex-grow-1">
                                                        <form class="add-new-record pt-0 new-forms row g-2" id="viewData" method="post" action="/Task/SaveSubTask">

                                                            <!-- Task Name -->
                                                            <div class="col-sm-12 mt-0">
                                                                <div class="new-input-box">
                                                                    <div class="main-input input-group-merge">
                                                                        <input type="text" id="VSubName" class="form-control" name="SubTaskName"
                                                                               placeholder="Enter Task Name" aria-label="Task Name"
                                                                               aria-describedby="basicFullname2" />
                                                                    </div>
                                                                </div>
                                                            </div>


                                                            <!-- Start Date -->
                                                            <div class="col-sm-4">
                                                                <div class="new-input-box upper-box">
                                                                    <label class="form-label mb-0" for="start-date">Start Date</label><br>
                                                                    <div class="d-flex align-items-center">
                                                                        <i class="fas fa-calendar-alt me-2"></i>
                                                                        <input type="date" id="Vstart-date" class="form-control custom-date" name="SubTaskStartDate"
                                                                               value="2025-03-20" />
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <!-- Duration -->
                                                            <span class="col-sm-4">
                                                                <div class="new-input-box upper-box">
                                                                    <label class="form-label" for="duration">Duration (Days)</label>
                                                                    <input type="text" id="Vduration" class="form-control" name="duration"
                                                                           placeholder="3 days" readonly />
                                                                </div>
                                                            </span>

                                                            <!-- End Date -->
                                                            <div class="col-sm-4">
                                                                <div class="new-input-box upper-box">
                                                                    <label class="form-label mb-0" for="due-date">End Date</label><br>
                                                                    <div class="d-flex align-items-center">
                                                                        <i class="fas fa-calendar-alt me-2"></i>
                                                                        <input type="date" id="Vdue-date" class="form-control custom-date" name="SubTaskEndDate"
                                                                               value="2025-03-23" />
                                                                    </div>
                                                                </div>
                                                            </div>

                                                            <div class="progress mt-2">
                                                                <div id="progress-bar" class="progress-bar bg-success" role="progressbar"
                                                                     style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                                                                </div>
                                                            </div>



                                                            <!-- Priority -->
                                                            <div class="col-md-12">
                                                                <div class="new-input-box">
                                                                    <label class="form-label" for="priority">Priority</label>
                                                                    <select name="PriorityId" id="VPriority" required class="form-select select2">
                                                                        @if (Model.PriorityList != null)
                                                                        {
                                                                            <option value=""> Select</option>
                                                                            @foreach (var item in Model.PriorityList)
                                                                            {
                                                                                <option value="@item.CompanyPriorityId">@item.CompanyPriority </option>

                                                                            }
                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>

                                                            <!-- Status -->
                                                            <div class="col-md-12">
                                                                <div class="new-input-box">
                                                                    <label class="form-label" for="basicEmail">Status</label>
                                                                    <select name="StatusId" id="VSubStatus" class="form-select select2">
                                                                        @if (Model.StatusList != null)
                                                                        {
                                                                            <option value=""> Select</option>
                                                                            @foreach (var item in Model.StatusList)
                                                                            {

                                                                                <option value="@item.ID">@item.Status </option>

                                                                            }
                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>


                                                            <!-- Assigned To -->
                                                            <div class="col-md-12">
                                                                <div class="new-input-box">
                                                                    <label for="TagifyUserList" class="form-label">Project Owner</label>
                                                                    <select name="OwnerId" id="VSubOwnerId" class="form-select select2">
                                                                        @if (Model.UserListForSubTask != null)
                                                                        {
                                                                            <option value=""> Select</option>
                                                                            @foreach (var item in Model.UserListForSubTask)
                                                                            {
                                                                                <option value="@item.UserId">@item.UserName </option>

                                                                            }
                                                                            <option value="0"> NA</option>
                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>


                                                            <!-- Assigned To -->
                                                            <div class="col-md-6 mb-4">
                                                                <div class="new-input-box">
                                                                    <label for="TagifyUserList" class="form-label">Collaborators</label>
                                                                    <select id="VSubCollaborators" name="SubCollaborators" class="select2 form-select" multiple>
                                                                        @{

                                                                            if (Model.UserListForSubTask != null)
                                                                            {

                                                                                foreach (var item in Model.UserListForSubTask)
                                                                                {


                                                                                        <option value="@item.UserId">@item.UserName </option>

                                                                                }
                                                                            }
                                                                        }
                                                                    </select>
                                                                </div>
                                                            </div>

                                                            <!-- Task Description -->
                                                            <div class="col-md-12 mb-2">
                                                                <label class="form-label fw-bold mt-2" for="project-description">
                                                                    
                                                                    Description
                                                                </label>
                                                                <textarea class="summernote-editor" id="myeditor" name="Description"></textarea>
                                                            </div>


                                                            <!-- File Upload Section -->
                                                            @*  <div class="col-md-12">
                                                            <label class="form-label" for="fileUpload">File Upload</label>
                                                            <input type="file" id="fileUpload" class="form-control border" name="fileUpload" />
                                                            </div> *@

                                                            <!-- Submit & Cancel Buttons -->
                                                            <div class="col-sm-12 text-end">
                                                                <input type="hidden" id="SubCollaborators" name="SubCollaborators" class="form-control" value="@Model.Collaborators" />
                                                                <input type="hidden" id="ProjectId" name="ProjectId" class="form-control" value="@Model.ProjectId" />
                                                                <input type="hidden" id="TaskId" name="TaskId" class="form-control" value="@Model.TaskId" />
                                                                <input type="hidden" id="SubTaskId" name="SubTaskId" class="form-control" />
                                                                <button type="button" class="btn btn-primary data-submit btn-new me-sm-4 me-1" onclick="SaveSubTask(0)">Save</button>
                                                                <button type="reset" id="btnEClose" class="btn btn-outline-secondary" data-bs-dismiss="offcanvas">Cancel</button>
                                                            </div>

                                                        </form>
                                                    </div>
                                                </div>
                                                <!-- Start Date -->
                                            </div>
                                        </div>
                                        <!-- drives area ends-->
                                        <!-- tabs -->
                                        <div class="row mt-5">
                                            <div class="col-12 mt-2">

                                                <ul class="nav nav-tabs tab-top-new tabs px-3 bg-light-theme" role="tablist">
                                                    <li class="nav-item">
                                                        <a class="nav-link new-link active" id="home" data-bs-toggle="tab" href="#comment"
                                                           aria-controls="home" role="tab" aria-selected="true">Comments</a>
                                                    </li>
                                                   @*  <li class="nav-item">
                                                        <a class="nav-link new-link " id="about" data-bs-toggle="tab" href="#issue"
                                                           aria-controls="about" role="tab" aria-selected="false">Issues</a>
                                                    </li> *@

                                                    <li class="nav-item">
                                                        <a class="nav-link new-link " id="about" data-bs-toggle="tab" href="#activity"
                                                           aria-controls="about" role="tab" aria-selected="false">Activities</a>
                                                    </li>

                                                </ul>

                                            </div>
                                        </div>
                                        <div class="tab-content task-tabs rounded-3">

                                            <div class="tab-pane active" id="comment" aria-labelledby="home" role="tabpanel">

                                                <!-- Task Description -->
                                                <div class="col-md-12 position-relative ">
                                                    <div class="textarea-container">
                                                        <textarea name="comment" placeholder="Type something..." id="SComments" row="1"
                                                                  class="w-100 p-2 border commet-new "></textarea>

                                                        <!-- Submit Button Inside Textarea -->

                                                        <button type="button" class="btn btn-primary submit-btn btn-new waves-effect waves-light d-none " onclick="SaveSubComments()">
                                                            <span>Submit</span>
                                                        </button>

                                                    </div>
                                                </div>
                                                <!-- Task Description -->

                                                <div class="col-md-12 mt-5" id="divSChat">

                                                    <!-- Comment desc -->
                                                    <!-- Comment desc -->
                                                </div>
                                            </div>
                                            <!-- </div> -->
                                            <!-- Issues  -->
                                            <div class="tab-pane" id="issue" aria-labelledby="about" role="tabpanel">
                                                <p>
                                                    Comming Soon....
                                                </p>
                                            </div>
                                            <!-- Issues  -->


                                            <div class="tab-pane" id="activity" aria-labelledby="about" role="tabpanel">
                                                <!-- ----timeline------  -->
                                                <div class="card">
                                                    <div class="card-body">
                                                        <ul class="timeline mb-0">
                                                            @if (Model.ActivityList != null)
                                                            {

                                                                @foreach (var item in Model.ActivityList)
                                                                {
                                                                    <li class="timeline-item timeline-item-transparent">
                                                                        <span class="timeline-point timeline-point-success"></span>
                                                                        <div class="timeline-event">
                                                                            <div class="timeline-header mb-3">
                                                                                <h6 class="mb-0">@item.TaskName</h6>
                                                                                <small class="text-muted">@item.CreationDate</small>
                                                                            </div>
                                                                            <p class="mb-2">@item.FullName: @item.Comments</p>
                                                                            <div class="d-flex justify-content-between flex-wrap gap-2 mb-2">
                                                                                <div class="d-flex flex-wrap align-items-center mb-50">
                                                                                    <div class="avatar avatar-sm me-2">
                                                                                        <img src="~/Profile/@item.ProfileName" alt="Avatar" class="rounded-circle" />
                                                                                    </div>
                                                                                    <div>
                                                                                        <p class="mb-0 small fw-medium">@item.FullName</p>
                                                                                        @*   <small>CEO of Pixinvent</small> *@
                                                                                    </div>
                                                                                </div>
                                                                            </div>
                                                                        </div>
                                                                    </li>
                                                                }
                                                            }

                                                        </ul>
                                                    </div>
                                                    </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <!-- </div> -->
                    </div>
                </div>

            </div>
        </div>

        <div class="offcanvas offcanvas-end" id="add-new-subtask">
            <div class="offcanvas-header border-bottom">
                <h5 class="offcanvas-title d-flex align-items-center gap-2" id="exampleModalLabel">
                    <i class="fa fa-chevron-left text-primary backToViewRecord" role="button"
                       style="cursor:pointer;"></i>Add Sub Task
                </h5>
                <button type="button" class="btn-close text-reset text-danger" data-bs-dismiss="offcanvas"
                        aria-label="Close"></button>
            </div>
            <div class="offcanvas-body flex-grow-1">
                <form class="add-new-record pt-0 new-forms row g-2" id="form-add-sub-task" method="post" action="/Task/SaveSubTask">

                    <div class="col-sm-12 mt-0">
                        <div class="new-input-box">
                            <div class="main-input input-group-merge">
                                <input type="text" id="ASubName" class="form-control" name="SubTaskName"
                                       placeholder="Enter Task Name" aria-label="Sub Task Name"
                                       aria-describedby="basicFullname2" />
                            </div>
                        </div>
                    </div>


                    <!-- Start Date -->
                    <div class="col-sm-4">
                        <div class="new-input-box upper-box">
                            <label class="form-label mb-0" for="start-date">Start Date </label><br>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-calendar-alt me-2"></i>
                                <input type="date" id="Astart-date" class="form-control date-picker" name="SubTaskStartDate"
                                       value="2025-03-20" />
                            </div>
                        </div>
                    </div>

                    <!-- Duration -->
                    <span class="col-sm-4">
                        <div class="new-input-box upper-box">
                            <label class="form-label" for="duration">Duration (Days)</label>
                            <input type="text" id="Aduration" class="form-control" name="duration"
                                   placeholder="3 days" readonly />
                        </div>
                    </span>

                    <!-- End Date -->
                    <div class="col-sm-4">
                        <div class="new-input-box upper-box">
                            <label class="form-label mb-0" for="due-date">End Date </label><br>
                            <div class="d-flex align-items-center">
                                <i class="fas fa-calendar-alt me-2"></i>
                                <input type="date" id="Adue-date" class="form-control date-picker" name="SubTaskEndDate"
                                       value="2025-03-23" />
                            </div>
                        </div>
                    </div>

                    <div class="progress mt-2">
                        <div id="progress-bar" class="progress-bar bg-success" role="progressbar"
                             style="width: 0%;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                        </div>
                    </div>



                    <!-- Priority -->
                    <div class="col-md-12">
                        <div class="new-input-box">
                            <label class="form-label" for="priority">Priority</label>
                            <select name="PriorityId" id="APriority" required class="form-select select2">
                                @if (Model.PriorityList != null)
                                {
                                    <option value=""> Select</option>
                                    @foreach (var item in Model.PriorityList)
                                    {
                                        <option value="@item.CompanyPriorityId">@item.CompanyPriority </option>

                                    }
                                }
                            </select>
                        </div>
                    </div>

                    <!-- Status -->
                    <div class="col-md-12">
                        <div class="new-input-box">
                            <label class="form-label" for="basicEmail">Status</label>
                            <select name="StatusId" id="ASubStatus" class="form-select select2">
                                @if (Model.StatusList != null)
                                {
                                    <option value=""> Select</option>
                                    @foreach (var item in Model.StatusList)
                                    {

                                        <option value="@item.ID">@item.Status </option>

                                    }
                                }
                            </select>
                        </div>
                    </div>


                    <!-- Assigned To -->
                    <div class="col-md-12">
                        <div class="new-input-box">
                            <label for="TagifyUserList" class="form-label">Project Owner</label>
                            <select name="OwnerId" id="ASubOwnerId" class="form-select select2">
                                @if (Model.UserListForSubTask != null)
                                {
                                    <option value=""> Select</option>
                                    @foreach (var item in Model.UserListForSubTask)
                                    {
                                        <option value="@item.UserId">@item.UserName </option>

                                    }
                                    <option value="0"> NA</option>
                                }
                            </select>
                        </div>
                    </div>


                    <!-- Assigned To -->
                    <div class="col-md-12 mb-4">
                        <div class="new-input-box">
                            <label for="TagifyUserList" class="form-label">Collaborators</label>
                            <select id="ASubCollaborators" name="SubCollaborators" class="select2 form-select" multiple>
                                @{

                                    if (Model.UserListForSubTask != null)
                                    {

                                        foreach (var item in Model.UserListForSubTask)
                                        {

                                                <option value="@item.UserId">@item.UserName </option>

                                        }
                                    }
                                }
                            </select>
                        </div>
                    </div>

                    <!-- Task Description -->
                    <div class="col-md-12 mb-2">
                        <label class="form-label fw-bold mt-2" for="project-description">Sub Task Description</label>
                        @*   <div id="summernote"></div> *@
                        <textarea class="summernote-editor" id="editorView" name="Description">
                            </textarea>
                        <!-- <textarea id="editor_classic-one" class="aha_editor" style="display:none;">
                        </textarea> -->
                    </div>

                    <!-- Attachment -->
                    @* <div class="col-md-6 mt-2 mb-6">
                    <label class="form-label" for="fileUpload">File Upload</label>
                    <input type="file" id="fileUpload" class="form-control border" name="fileUpload" />
                    </div> *@

                    <!-- Submit & Cancel Buttons -->
                    <div class="col-sm-12">
                        <input type="hidden" id="SubCollaborators" name="SubCollaborators" class="form-control" value="@Model.Collaborators" />
                        <input type="hidden" id="ProjectId" name="ProjectId" class="form-control" value="@Model.ProjectId" />
                        <input type="hidden" id="TaskId" name="TaskId" class="form-control" value="@Model.TaskId" />
                        @*   <input type="hidden" id="SubTaskId" name="SubTaskId" class="form-control" /> *@
                        <button type="button" class="btn btn-primary data-submit me-sm-4 me-1" onclick="SaveSubTask(1)">Add Sub Task</button>
                        <button type="reset" id="btnClose" class="btn btn-outline-secondary" data-bs-dismiss="offcanvas">Cancel</button>
                    </div>

                </form>
            </div>
        </div>


        <input type="hidden" id="selId" name="id" class="form-control" value="0" />


    </div>
    <!-- Content wrapper -->
</div>
<div class="loader" style="display:none"><div class="loader_inner"><span class="loader-spinner"></span></div></div>

@section scripts {

    @*  <script defer src="~/assets/js/project-datatable.js" asp-append-version="true"></script> *@
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/7.2.0/sweetalert2.all.min.js" asp-append-version="true"></script>
    <!-- ---summernote-js----  -->
    <script defer src="~/assets/summernote-editor/js/summernote-lite.min.js" asp-append-version="true"></script>

    <script defer src="~/assets/summernote-editor/js/summernote-custom.js" asp-append-version="true"></script>
    @*     <script defer src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-3-typeahead/4.0.2/bootstrap3-typeahead.min.js"></script>
 *@    @* <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script> *@
    <script>
        var selPriortiy = '';
        var prjStatus = '';
        var selPhase = '';
        var owner = '';
        var sDate = '';
        var eDate = '';
        var task = '';
        var vendor = '';
        var collUser = '';
        $(document).ready(function ($) {

            $('.summernote-editor').summernote({
                height: 200,
                toolbar: [
                    ['style', ['bold', 'italic', 'underline', 'clear']],
                    ['font', ['strikethrough', 'superscript', 'subscript']],
                    ['fontsize', ['fontsize']],
                    ['color', ['color']],
                    ['para', ['ul', 'ol', 'paragraph']],
                    ['height', ['height']]
                ]
            });
            // $('#taskTable').hide();
            //  $('#projectTableSkeleton').show();

            setTimeout(function () { // Simulate async data load, replace with actual AJAX if needed
                //  $('#projectTableSkeleton').hide();
                //  $('#taskTable').show();
                const isMobile = window.innerWidth <= 768;
                $('.project-datatable').DataTable({
                    responsive: isMobile,
                    paging: true,
                    searching: true,
                    ordering: true,
                    info: true,
                    autoWidth: false,
                    lengthMenu: [10, 25, 50, 100],
                    language: {
                        search: "Search:",
                        lengthMenu: "Show _MENU_ entries",
                        info: "Showing _START_ to _END_ of _TOTAL_ entries",
                        paginate: {
                            previous: "Prev",
                            next: "Next"
                        }
                    }
                });
            }, 600); // Adjust delay as needed



            if (@Model.TaskId != 0 || @Model.HttpStatusCode!= 200) {
                GetSubTaskDashboard(@Model.TaskId);
                GetComments();
                if ("@Model.IsView" == "False") {

                    offCanvasElement = document.querySelector('#add-new-task');
                }
                else {
                    offCanvasElement = document.querySelector('#view-record');
                }

                offCanvasEl = new bootstrap.Offcanvas(offCanvasElement);
                offCanvasEl.show();
            }

            $.each($("#Collaborators").val().split(","), function (i, e) {
                $("#selCollaborators option[value='" + e + "']").prop("selected", true);
            });

        });

        function getTaskId() {
            // alert('test');
            offCanvasElement = document.querySelector('#view-record');
            offCanvasEl = new bootstrap.Offcanvas(offCanvasElement);
            offCanvasEl.show();

        }
        document.addEventListener("DOMContentLoaded", function () {
            let vendorList = document.getElementById("vendor-list");
            let inhouseRadio = document.getElementById("assign-to-inhouse");
            let vendorRadio = document.getElementById("assign-to-vendor");

            function toggleVendorList() {
                if (vendorRadio.checked) {
                    vendorList.style.display = "block";
                } else {
                    vendorList.style.display = "none";
                }
            }

            inhouseRadio.addEventListener("change", toggleVendorList);
            vendorRadio.addEventListener("change", toggleVendorList);

            // Initial check
            toggleVendorList();
        });
        function GetCollaboration() {
            var select = document.getElementById('selCollaborators');
            var selected = [...select.options]
                .filter(option => option.selected)
                .map(option => option.value);

            jQuery("#Collaborators").val(selected);

            var selectedText = [...select.options]
                .filter(option => option.selected)
                .map(option => option.text);

            collUser = "Collaboration Users- " + selectedText;
        }
        function GetTaskCollaboration() {
            var select = document.getElementById('TaskCollaborators');
            var selected = [...select.options]
                .filter(option => option.selected)
                .map(option => option.value);

            jQuery("#TCollaborators").val(selected);

            var selectedText = [...select.options]
                .filter(option => option.selected)
                .map(option => option.text);

            collUser = "Collaboration Users- " + selectedText;
        }
        function ProjectDDL(projectId) {
            //  phaseId = $("#selPhase").val();
            priorityId = $("#SelPriorityId").val();
            statusId = $("#selStatus").val();
            window.location.href = "/Task/TaskManagementwithFilter?pId=" + projectId + "&priorityId=" + priorityId + "&phaseId=0&statusId=" + statusId;

        }
        function PhaseDDL(phaseId) {
            projectId = $("#selProject").val();
            priorityId = $("#SelPriorityId").val();
            statusId = $("#selStatus").val();
            window.location.href = "/Task/TaskManagementwithFilter?pId=" + projectId + "&priorityId=" + priorityId + "&phaseId=" + phaseId + "&statusId=" + statusId;

        }
        function StatusDDL(statusId) {
            // phaseId = $("#selPhase").val();
            priorityId = $("#SelPriorityId").val();
            projectId = $("#selProject").val();
            window.location.href = "/Task/TaskManagementwithFilter?pId=" + projectId + "&priorityId=" + priorityId + "&phaseId=0&statusId=" + statusId;

        }
        function PriorityDDL(priorityId) {
            // phaseId = $("#selPhase").val();
            statusId = $("#selStatus").val();
            projectId = $("#selProject").val();
            window.location.href = "/Task/TaskManagementwithFilter?pId=" + projectId + "&priorityId=" + priorityId + "&phaseId=0&statusId=" + statusId;

        }


        document.addEventListener("DOMContentLoaded", function () {
            // Select all tab containers (e.g., those with class 'tab-content')
            let tabContainers = document.querySelectorAll('.tab-content');
            tabContainers.forEach(container => {
                let activeTab = container.querySelector('.tab-pane.active');
                if (activeTab) {
                    activeTab.classList.add('show');
                }
            });
        });



        function PopulatePriority() {
            selPriortiy = "Priority- " + $("#priority").find("option:selected").text() + ",";
        }

        function PopulatePhase() {
            selPhase = "Phase- " + $("#projectPhase").find("option:selected").text() + ",";
        }

        function PopulateVendor() {
            vendor = "Vendor- " + $("#vendorList").find("option:selected").text() + ",";
        }
        function PopulateStatus() {
            prjStatus = "Status- " + $("#StatusId").find("option:selected").text() + ",";
        }

        // function PopulateStatus() {
        //     prjStatus = "Status- " + $("#selStatus").find("option:selected").text() + ",";
        // }
        function PopulateUser() {
            owner = "Task Owner- " + $("#TaskOwnerId").find("option:selected").text() + ",";
        }
        // $("#TaskName").on('change', function () {
        //     task = "Task Name- " + $("#TaskName").val() + ",";
        // });
        function StDate(e) {
            sDate = "Start Date- " + e.target.value + ",";
        }
        function EDate(e) {
            $(":submit").attr("disabled", false);
            var date1 = new Date($("#start-date").val());
            var date2 = new Date($("#due-date").val());
            const diffTime = Math.abs(date2 - date1);
            //  alert(diffTime);
            if (date1 > date2) {
                $(":submit").attr("disabled", true);
                alert("End date cannot be less than Start date");
                // ShowServerMessage("End date cannot be less than Start date");
                return;
            }

            eDate = "End Date- " + e.target.value;
        }
        function SaveUserActivities(taskId) {



            if (taskId > 0) {
                task = "Task Name:- " + $("#TaskName").val() + ": ";
                var rowData = {};
                // let result = selPriortiy.concat(" ", selPhase, " ", prjStatus, " ", owner, " ", task, " ", sDate, " ", eDate, " ", vendor);
                let result = task.concat(" ", selPhase, " ", prjStatus, " ", owner, " ", selPriortiy, " ", sDate, " ", eDate, " ", vendor, " ", collUser);

                if (result.trim() == '0' || result.trim() == '' || result.trim() == 'undefined' || result.trim() == null) {
                    return;
                }

                // if (taskId > 0)
                //  result = result + 'Edit By';
                // else
                //     result = result + ' Created By';
                $(".loader").show();
                rowData.Comments = 'Edit:- ' + result;
                rowData.Summary = "Task Management"
                rowData.ProjectId = $("#ProjectId").val();
                rowData.TaskId = $("#TaskId").val();
                jQuery.ajax({
                    type: "POST",
                    url: "/Task/SaveComments",
                    data: { inputs: rowData },
                    success: function (data) {
                        $(".loader").hide();

                    },
                    error: function (result) {
                        var x = 1;
                       // alert("errror<br>" + result.responseText);

                    }
                });
            }
        }

    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            function calculateDuration() {
                const startDate = document.getElementById("startdate").value;
                const endDate = document.getElementById("duedate").value;
                const durationField = document.getElementById("duration");
                const progressBar = document.getElementById("progress-bar");

                if (startDate && endDate) {
                    const start = new Date(startDate);
                    const end = new Date(endDate);
                    const diffDays = Math.max((end - start) / (1000 * 60 * 60 * 24), 0);

                    durationField.value = diffDays > 0 ? diffDays + " Days" : "0";

                    // Progress Calculation
                    const totalDuration = 30; // Assume 30 days for full progress bar
                    const progress = Math.min((diffDays / totalDuration) * 100, 100);
                    progressBar.style.width = progress + "%";
                    progressBar.setAttribute("aria-valuenow", progress);
                } else {
                    durationField.value = "";
                    progressBar.style.width = "0%";
                }
            }

            function previewImage(event) {
                const image = document.getElementById("uploaded-image");
                image.src = URL.createObjectURL(event.target.files[0]);
            }

            document.getElementById("startdate").addEventListener("change", calculateDuration);
            document.getElementById("duedate").addEventListener("change", calculateDuration);

            calculateDuration(); // Initial calculation if values are pre-filled
        });

        function SaveSubComments() {
            // alert($("#comments").val());

            if ($("#SComments").val() == '') {
                swal(
                    'Validation!',
                    'Please add the comments!',
                    'warning'
                )
                return;
            }
            $(".loader").show();
            var rowData = {};
            rowData.ID = $("#selId").val();
            rowData.Summary = "Comments"
            rowData.Comments = $("#SComments").val();
            rowData.ProjectId = $("#ProjectId").val();
            rowData.TaskId = $("#TaskId").val();
            rowData.SubTaskId = $("#SubTaskId").val();
            jQuery.ajax({
                type: "POST",
                url: "/Task/SaveComments",
                data: { inputs: rowData },
                success: function (data) {
                    $("#SComments").val('');
                    $("#selId").val(0);
                    GetComments();
                    $(".loader").hide();
                },
                error: function (result) {
                    var x = 1;
                   // alert("errror<br>" + result.responseText);

                }
            });

        }

        function SaveComments() {
            // alert($("#comments").val());
            // alert('notification');
            // RefreshNotifcation();

            if ($("#comments").val() == '') {
                swal(
                    'Validation!',
                    'Please add the comments!',
                    'warning'
                )
                return;
            }
            $(".loader").show();
            var rowData = {};
            rowData.ID = $("#selId").val();
            rowData.Summary = "Comments"
            rowData.Comments = $("#comments").val();
            rowData.ProjectId = $("#ProjectId").val();
            rowData.TaskId = $("#TaskId").val();
            rowData.SubTaskId = 0;
            jQuery.ajax({
                type: "POST",
                url: "/Task/SaveComments",
                data: { inputs: rowData },
                success: function (data) {
                    $(".loader").hide();
                    $("#comments").val('');
                    $("#selId").val(0);
                    GetComments();

                },
                error: function (result) {
                    var x = 1;
                   // alert("errror<br>" + result.responseText);

                }
            });

        }

        function RefreshNotifcation() {

            $.ajax({
                type: "POST",
                contentType: "application/json; charset=utf-8",
                url: '/Home/UserNotification',
                // data: JSON.stringify(inputDTO),
                cache: false,
                dataType: "html",
                success: function (data, textStatus, jqXHR) {
                    // $('#div_TodayMeetings').html(data);
                    // UnblockUI();
                },
                error: function (result) {
                  //  alert(result.responseText);
                    //UnblockUI();
                }
            });
        }

        function GetComments() {

            $('#divSChat div').html('');
            $('#divChat div').html('');
            var chatWindow = '';
            var rowData = {};
            //  rowData.Comments = $("#comments").val();
            rowData.IsComment = true;
            rowData.ProjectId = $("#ProjectId").val();
            rowData.TaskId = $("#TaskId").val();
            rowData.SubTaskId = 0;
            jQuery.ajax({
                type: "POST",
                url: "/Task/GetComments",
                data: { inputs: rowData },
                success: function (data) {
                    if (data != null) {

                        console.log(data);
                        // $("divChat").empty();
                        $.each(data, function (key, item) {

                            chatWindow += '<div class="chat-group"><div class="chat-avatar">'
                            chatWindow += '<img style="width:20px;height:20px;" class="rounded-circle" src = /Profile/' + (item.profileName == null ? "user-default.png":item.profileName) + ' > </div>';
                            chatWindow += '<div class="chat-body"><div class="chat-content pt-2  elevation-2 chat-left  bg-light-theme" id="chat-new-content"> <div class="chat-head w-100   px-2">';
                            chatWindow += ' <div class="top-header"> <div id="title-name" class="fw-semibold text-dark"> <b class="title">' + item.fullName + '</b>   <small class="time ms-4">' + item.creationDate + ' </small> </div>';
                            chatWindow += ' <div class="right-side-icon"><div class="thumb-icon"><button class="btn btn-sm btn-icon text-muted p-0 border-0 bg-transparent me-4">';
                           // chatWindow += '<i class="ti ti-thumb-up ti-md me-1" id="thumbs-up" onclick="toggleThumbColor(this)" data-bs-toggle="tooltip" title="Like"></i><small class="numbers" onclick="toggleLikesDropdown(this, event)">230</small></button>';
                            chatWindow += '<div class="likes-dropdown  shadow-sm  rounded p-2"><h6 class="fw-semibold mb-2">Liked by</h6>';
                            chatWindow += '<ul class="list-unstyled mb-0"><li class="likes-profile d-flex mb-2"><img src="assets/img/avatars/16.png" class="rounded-circle me-2" alt="User 1">';
                            chatWindow += '<small class="person-name">Jane Smith</small></li><li class="likes-profile d-flex mb-2"><img src="assets/img/avatars/16.png" class="rounded-circle me-2" alt="User 2">';
                            chatWindow += '<small class="person-name">Michael Brown</small></li></ul></div></div><div class="dropdown"><button class="chat-dot-icon btn  rounded-pill text-muted border-0 p-0 bg-transparent" type="button" id="chatMenu" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">';
                            chatWindow += '<i class="ti ti-dots-vertical ti-md text-muted"></i></button> <div class="dropdown-menu dropdown-menu-end" aria-labelledby="chatMenu">';
                            chatWindow += ' <a class="dropdown-item" onclick="EditComments(' + item.id + ')" href="javascript:void(0);">Edit</a><a class="dropdown-item" onclick="DeleteComments(' + item.id + ')" href="javascript:void(0);">Delete</a></div></div></div></div></div>';
                            chatWindow += '<p class="ps-2 pt-0 me-5 text-base new-base">' + item.comments + '</p>';
                            chatWindow += '</div></div> </div>';

                        });
                        // console.log(chatWindow);

                        $("#divChat").append(chatWindow);
                        $("#divSChat").append(chatWindow);
                    }
                },
                error: function (result) {
                    var x = 1;
                  //  alert("errror<br>" + result.responseText);

                }
            });

        }

        function EditComments(id) {

            $(".loader").show();
            jQuery.ajax({
                type: "GET",
                url: "/Task/GetCommentById",
                data: { Id: id },
                success: function (data) {
                    // console.log(data);
                    //  alert(data.id);
                    $("#comments").val(data.comments);
                    $("#selId").val(data.id);
                    $(".loader").hide();

                },
                error: function (result) {
                    var x = 1;
                   // alert("errror<br>" + result.responseText);

                }
            });

        }
        function DeleteComments(id) {

            if (confirm("Sure, you want to delete this comment ?")) {
                $(".loader").show();
                var rowData = {};
                rowData.ID = id;
                jQuery.ajax({
                    type: "POST",
                    url: "/Task/DeleteComments",
                    data: { inputs: rowData },
                    success: function (data) {
                        //  $("#comments").val('');
                        GetComments();
                        $(".loader").hide();
                    },
                    error: function (result) {
                        var x = 1;
                       // alert("errror<br>" + result.responseText);

                    }
                });
            }
        }

        function GetSubTask(tid) {
            $(".loader").show();
            jQuery.ajax({
                type: "GET",
                url: "/SubTask/GetSubTaskView",
                data: { pId: tid },
                success: function (data) {
                    if (data != null) {
                        $(".loader").hide();

                        document.querySelector("#Vstart-date").valueAsDate = new Date(data.startDate);
                        document.querySelector("#Vdue-date").valueAsDate = new Date(data.endDate);
                        const diffTime = Math.abs(new Date(data.endDate) - new Date(data.startDate));
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        $("#VSubName").val(data.subTaskName);
                        $("#SubTaskId").val(data.subTaskId);
                        $('#myeditor').summernote('code', data.description);

                        $("#Vduration").val(diffDays);
                        // if (data.priorityId != 0) {
                        $('#VPriority option[value=' + data.priorityId + ']').attr('selected', 'selected').change();
                        $('#VSubStatus option[value=' + data.statusId + ']').attr('selected', 'selected').change();
                        $('#VSubOwnerId option[value=' + data.ownerId + ']').attr('selected', 'selected').change();
                        $('#VSubCollaborators option[value=' + data.collaborators + ']').attr('selected', 'selected').change();
                        // }
                    }


                },
                error: function (result) {
                    var x = 1;
                   /// alert("errror<br>" + result.responseText);

                }
            });
        }

        function DeleteTaskConfirmation(etid) {
            Swal.fire({
                title: 'Are you sure?',
                text: "It will be permanently deleted!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed) {

                    $(".loader").show();
                    jQuery.ajax({
                        type: "GET",
                        url: "/Task/DeleteTask",
                        data: { epId: etid },
                        success: function (data) {
                            $(".loader").hide();
                            
                            location.reload();
                           
                           // window.location.href = "/Task/TaskDetails";

                        },
                        error: function (result) {
                            $(".loader").hide();
                            var x = 1;
                           // alert("errror<br>" + result.responseText);

                        }
                    });

                    Swal.fire(
                        'Deleted!',
                        'Your file has been deleted.',
                        'success'
                    );
                    return true;
                }
                return false;
            });
        }

        function GetSubTaskDashboard(tid) {

            $(".loader").show();
            // var TaskId = $("#TaskId").val();
            jQuery("#mycountrytbl").html("")
            jQuery.ajax({
                type: "GET",
                url: "/SubTask/GetSubTaskDashboard",
                data: { taskId: tid },
                success: function (data) {
                    if (data != null) {
                        $(".loader").hide();
                        var serId = 1;
                        // console.log(data);
                        // $("divChat").empty();
                        $.each(data, function (key, item) {
                            if (item.status.trim() == 'Open Tasks') {
                                if (item.priority.trim() == 'Low')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-green">' + item.priority + '</span></td><td><span class="badge bg-label-danger">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else if (item.priority.trim() == 'Normal')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-blue">' + item.priority + '</span></td><td><span class="badge bg-label-danger">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else if (item.priority.trim() == 'High')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-orange">' + item.priority + '</span></td><td><span class="badge bg-label-danger">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-red">' + item.priority + '</span></td><td><span class="badge bg-label-danger">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');

                            }
                            else if (item.status.trim() == 'Completed') {
                                if (item.priority.trim() == 'Low')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-green">' + item.priority + '</span></td><td><span class="badge bg-label-success">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else if (item.priority.trim() == 'Normal')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-blue">' + item.priority + '</span></td><td><span class="badge bg-label-success">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else if (item.priority.trim() == 'High')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-orange">' + item.priority + '</span></td><td><span class="badge bg-label-success">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-red">' + item.priority + '</span></td><td><span class="badge bg-label-success">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');

                            }

                            else if (item.status.trim() == 'Overdue') {
                                if (item.priority.trim() == 'Low')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-green">' + item.priority + '</span></td><td><span class="badge bg-label-danger">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else if (item.priority.trim() == 'Normal')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-blue">' + item.priority + '</span></td><td><span class="badge bg-label-danger">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else if (item.priority.trim() == 'High')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-orange">' + item.priority + '</span></td><td><span class="badge bg-label-danger">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-red">' + item.priority + '</span></td><td><span class="badge bg-label-danger">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');

                            }

                            else if (item.status.trim() == 'In Progress') {
                                if (item.priority.trim() == 'Low')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-green">' + item.priority + '</span></td><td><span class="badge bg-label-warning">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else if (item.priority.trim() == 'Normal')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-blue">' + item.priority + '</span></td><td><span class="badge bg-label-warning">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else if (item.priority.trim() == 'High')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-orange">' + item.priority + '</span></td><td><span class="badge bg-label-warning">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-red">' + item.priority + '</span></td><td><span class="badge bg-label-warning">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');

                            }
                            else {
                                if (item.priority.trim() == 'Low')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-green">' + item.priority + '</span></td><td><span class="badge bg-label-success">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else if (item.priority.trim() == 'Normal')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-blue">' + item.priority + '</span></td><td><span class="badge bg-label-success">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else if (item.priority.trim() == 'High')
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-orange">' + item.priority + '</span></td><td><span class="badge bg-label-success">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');
                                else
                                    $("#mycountrytbl").append('<tr><td>' + serId + '</td><td><div class="d-flex gap-2"><span>' + item.subTaskName + '</span><div class="action-button hover-action-button ms-auto" style="visibility:initial;"><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" class="btn btn-outline-primary waves-effect" data-bs-toggle="offcanvas" data-bs-target="#view-data"><i class="fa fa-eye me-1"></i> View</a></div></div></td><td>' + item.taskOwner + '</td><td><span class="bg-label-red">' + item.priority + '</span></td><td><span class="badge bg-label-danger">' + item.status + '</span></td><td>' + item.startDate + '</td><td>' + item.endDate + '</td><td>' + item.duration + '</td><td>' + item.createdBy + '</td><td>' + item.createdOn + '</td><td><a href="#" onclick="GetSubTask(' + item.subTaskId + ')" data-bs-toggle="offcanvas" data-bs-target="#view-data" ><i class="fa fa-eye text-success me-1"></i></a><a href="#" onclick="DeleteSubTask(' + item.subTaskId + ')"><i class="fa fa-trash text-danger me-1"></i></a></td></tr>');

                            }


                            serId++;
                        });
                        // console.log(chatWindow);

                        //  $("#divChat").append(chatWindow);
                    }

                },
                error: function (result) {
                    var x = 1;
                   // alert("errror<br>" + result.responseText);

                }
            });

        }

        function SaveSubTask(isAdd) {

            //  alert(parseInt(isAdd));


            var rowData = {};

            if (parseInt(isAdd) == 1) {
                rowData.SubTaskId = 0;

                if (validateInputs($("#ASubName").val())) {

                    alert('Sub Task is left blank');
                    return false;
                }
                if (validateInputs($("#Astart-date").val())) {
                    alert('Start Date is left blank');
                    return false;
                }
                if (validateInputs($("#Adue-date").val())) {
                    alert('End Date is left blank');
                    return false;
                }
                if (validateInputs($("#APriority").val())) {
                    alert('select the Priority');
                    return false;
                }
                if (validateInputs($("#ASubStatus").val())) {
                    alert('select the Status');
                    return false;
                }
                if (validateInputs($("#ASubOwnerId").val())) {
                    alert('select the Owner');
                    return false;
                }

                //   return;

                rowData.OwnerId = $("#ASubOwnerId").val();
                rowData.PriorityId = $("#APriority").val();
                rowData.StatusId = $("#ASubStatus").val();
                rowData.Collaborators = $("#ASubCollaborators").val();
                rowData.SubTaskName = $("#ASubName").val();
                rowData.StartDate = $("#Astart-date").val();
                rowData.EndDate = $("#Adue-date").val();
                rowData.ProjectId = $("#ProjectId").val();
                rowData.TaskId = $("#TaskId").val();
                rowData.Description = $('#editorView').summernote('code');
            }
            else {

                // alert('Edit');
                rowData.SubTaskId = $("#SubTaskId").val();
                rowData.OwnerId = $("#VSubOwnerId").val();
                rowData.PriorityId = $("#VPriority").val();
                rowData.StatusId = $("#VSubStatus").val();
                rowData.Collaborators = $("#VSubCollaborators").val();
                rowData.SubTaskName = $("#VSubName").val();
                rowData.StartDate = $("#Vstart-date").val();
                rowData.EndDate = $("#Vdue-date").val();
                rowData.ProjectId = $("#ProjectId").val();
                rowData.TaskId = $("#TaskId").val();
                rowData.Description = $('#myeditor').summernote('code');
            }

            $(".loader").show();

            jQuery.ajax({
                type: "POST",
                url: "/SubTask/SaveSubTask",
                data: { inputs: rowData },
                success: function (data) {
                    $(".loader").hide();
                    GetSubTaskDashboard($("#TaskId").val());

                    $("#btnClose").trigger("click");
                    $("#btnEClose").trigger("click");

                    //  alert('Test');
                },
                error: function (result) {
                    var x = 1;
                  //  alert("errror<br>" + result.responseText);

                }
            });

        }

        function validateInputs(ctrl) {
            //  alert(ctrl);
            if (ctrl == '') {
                return true;
            }
            return false;

        }

        function DeleteSubTask(tid) {

            Swal.fire({
                title: 'Are you sure?',
                text: "It will be permanently deleted!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Yes, delete it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {

                if (result.isConfirmed) {
                    $(".loader").show();
                    jQuery.ajax({
                        type: "POST",
                        url: "/SubTask/DeleteSubTask",
                        data: { pId: tid },
                        success: function (data) {
                            $(".loader").hide();
                            GetSubTaskDashboard(@Model.TaskId);
                            $("#btnClose").trigger("click");
                            $("#btnEClose").trigger("click");

                        },
                        error: function (result) {
                            var x = 1;
                           // alert("errror<br>" + result.responseText);

                        }
                    });

                    Swal.fire(
                        'Deleted!',
                        'Your file has been deleted.',
                        'success'
                    );
                }
            });
            // alert("Sure, you want to delete this Sub Task ?");
            // alert(tid);
            // return false;


        }
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const viewBtns = document.querySelectorAll(".viewSwitchBtn");
            const viewRecordEl = document.getElementById("view-record");

            viewBtns.forEach((btn) => {
                btn.addEventListener("click", function () {
                    const targetId = this.getAttribute("data-target");
                    const taskId = this.getAttribute("data-task-id");

                    // Hide all offcanvas elements
                    const offcanvasElements = document.querySelectorAll(".offcanvas");
                    offcanvasElements.forEach((el) => {
                        const bsOffcanvas = bootstrap.Offcanvas.getInstance(el);
                        if (bsOffcanvas) {
                            bsOffcanvas.hide();
                        }
                    });

                    // Show the target offcanvas
                    const targetOffcanvas = document.getElementById(targetId);
                    if (targetOffcanvas) {
                        const bsOffcanvas = new bootstrap.Offcanvas(targetOffcanvas);
                        bsOffcanvas.show();

                        // If the target is the view-record, fetch and display the data
                        if (targetId === "view-record") {
                            GetSubTask(taskId);
                        }
                    }
                });
            });
        });
    </script>
}